{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "7d0c9b98-4bcb-468f-90b7-82162f024c18",
   "metadata": {},
   "outputs": [],
   "source": [
    "from env import config, BASE_DIR\n",
    "from sqlalchemy import create_engine, text"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "ce2f0ae8-1212-4a12-a5aa-ef4e830bab3e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "DATABASE_URL = config(\"FLIGHT_PRICES_DATABASE_URL\", cast=str, default=None)\n",
    "DATABASE_URL is not None"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "0957001a-e3d7-47d4-87b6-b2aebf3c9687",
   "metadata": {},
   "outputs": [],
   "source": [
    "engine = create_engine(str(DATABASE_URL))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "8c17dc67-07ba-409f-ab80-072a0cdcd2ea",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "DATASET_DIR = BASE_DIR / \"datasets\"\n",
    "DATASET_DIR.exists()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "d17d1c09-52ce-4f43-919d-de19eaff2fab",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "FLIGHT_PRICES_CSV = DATASET_DIR / \"itineraries-min-50k.csv\"\n",
    "FLIGHT_PRICES_CSV.exists()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "c6050089-7e9d-485f-af92-191217e988d8",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "56dfeca7-27d2-4c99-b9d4-29be214365e7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>legId</th>\n",
       "      <th>searchDate</th>\n",
       "      <th>flightDate</th>\n",
       "      <th>startingAirport</th>\n",
       "      <th>destinationAirport</th>\n",
       "      <th>fareBasisCode</th>\n",
       "      <th>travelDuration</th>\n",
       "      <th>elapsedDays</th>\n",
       "      <th>isBasicEconomy</th>\n",
       "      <th>isRefundable</th>\n",
       "      <th>...</th>\n",
       "      <th>segmentsArrivalTimeEpochSeconds</th>\n",
       "      <th>segmentsArrivalTimeRaw</th>\n",
       "      <th>segmentsArrivalAirportCode</th>\n",
       "      <th>segmentsDepartureAirportCode</th>\n",
       "      <th>segmentsAirlineName</th>\n",
       "      <th>segmentsAirlineCode</th>\n",
       "      <th>segmentsEquipmentDescription</th>\n",
       "      <th>segmentsDurationInSeconds</th>\n",
       "      <th>segmentsDistance</th>\n",
       "      <th>segmentsCabinCode</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>9ca0e81111c683bec1012473feefd28f</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>LA0NX0MC</td>\n",
       "      <td>PT2H29M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650223560</td>\n",
       "      <td>2022-04-17T15:26:00.000-04:00</td>\n",
       "      <td>BOS</td>\n",
       "      <td>ATL</td>\n",
       "      <td>Delta</td>\n",
       "      <td>DL</td>\n",
       "      <td>Airbus A321</td>\n",
       "      <td>8940</td>\n",
       "      <td>947</td>\n",
       "      <td>coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>98685953630e772a098941b71906592b</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>LA0NX0MC</td>\n",
       "      <td>PT2H30M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650200400</td>\n",
       "      <td>2022-04-17T09:00:00.000-04:00</td>\n",
       "      <td>BOS</td>\n",
       "      <td>ATL</td>\n",
       "      <td>Delta</td>\n",
       "      <td>DL</td>\n",
       "      <td>Airbus A321</td>\n",
       "      <td>9000</td>\n",
       "      <td>947</td>\n",
       "      <td>coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>98d90cbc32bfbb05c2fc32897c7c1087</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>LA0NX0MC</td>\n",
       "      <td>PT2H30M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650218700</td>\n",
       "      <td>2022-04-17T14:05:00.000-04:00</td>\n",
       "      <td>BOS</td>\n",
       "      <td>ATL</td>\n",
       "      <td>Delta</td>\n",
       "      <td>DL</td>\n",
       "      <td>Boeing 757-200</td>\n",
       "      <td>9000</td>\n",
       "      <td>947</td>\n",
       "      <td>coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>969a269d38eae583f455486fa90877b4</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>LA0NX0MC</td>\n",
       "      <td>PT2H32M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650227460</td>\n",
       "      <td>2022-04-17T16:31:00.000-04:00</td>\n",
       "      <td>BOS</td>\n",
       "      <td>ATL</td>\n",
       "      <td>Delta</td>\n",
       "      <td>DL</td>\n",
       "      <td>Airbus A321</td>\n",
       "      <td>9120</td>\n",
       "      <td>947</td>\n",
       "      <td>coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>980370cf27c89b40d2833a1d5afc9751</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>LA0NX0MC</td>\n",
       "      <td>PT2H34M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650213180</td>\n",
       "      <td>2022-04-17T12:33:00.000-04:00</td>\n",
       "      <td>BOS</td>\n",
       "      <td>ATL</td>\n",
       "      <td>Delta</td>\n",
       "      <td>DL</td>\n",
       "      <td>Airbus A321</td>\n",
       "      <td>9240</td>\n",
       "      <td>947</td>\n",
       "      <td>coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>79eda9f841e226a1e2121d74211e595c</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>VH0AUEL1</td>\n",
       "      <td>PT2H38M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650216180</td>\n",
       "      <td>2022-04-17T13:23:00.000-04:00</td>\n",
       "      <td>BOS</td>\n",
       "      <td>ATL</td>\n",
       "      <td>JetBlue Airways</td>\n",
       "      <td>B6</td>\n",
       "      <td>NaN</td>\n",
       "      <td>9480</td>\n",
       "      <td>947</td>\n",
       "      <td>coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>9335fae376c38bb61263281779f469ec</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT4H12M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650203400||1650213120</td>\n",
       "      <td>2022-04-17T09:50:00.000-04:00||2022-04-17T12:3...</td>\n",
       "      <td>CLT||BOS</td>\n",
       "      <td>ATL||CLT</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Airbus A320||Airbus A320</td>\n",
       "      <td>5400||7500</td>\n",
       "      <td>228||728</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>3904bf87f2d1daf334f1ae7e3b876028</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT5H18M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650203400||1650217080</td>\n",
       "      <td>2022-04-17T09:50:00.000-04:00||2022-04-17T13:3...</td>\n",
       "      <td>CLT||BOS</td>\n",
       "      <td>ATL||CLT</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Airbus A320||Boeing 737-800</td>\n",
       "      <td>5400||8280</td>\n",
       "      <td>228||728</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>d93988734c44a3c075d9efe373352507</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT5H32M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650198060||1650213120</td>\n",
       "      <td>2022-04-17T08:21:00.000-04:00||2022-04-17T12:3...</td>\n",
       "      <td>CLT||BOS</td>\n",
       "      <td>ATL||CLT</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Airbus A319||Airbus A320</td>\n",
       "      <td>4860||7500</td>\n",
       "      <td>228||728</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>562e7d5dd6ecbf1509c0c19711dbdca9</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT6H38M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650198060||1650217080</td>\n",
       "      <td>2022-04-17T08:21:00.000-04:00||2022-04-17T13:3...</td>\n",
       "      <td>CLT||BOS</td>\n",
       "      <td>ATL||CLT</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Airbus A319||Boeing 737-800</td>\n",
       "      <td>4860||8280</td>\n",
       "      <td>228||728</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>c38a6e4b807d15541e5866676febcbec</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>VAA0AKEN</td>\n",
       "      <td>PT4H46M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650194280||1650204960</td>\n",
       "      <td>2022-04-17T07:18:00.000-04:00||2022-04-17T10:1...</td>\n",
       "      <td>IAD||BOS</td>\n",
       "      <td>ATL||IAD</td>\n",
       "      <td>United||United</td>\n",
       "      <td>UA||UA</td>\n",
       "      <td>Airbus A319||Boeing 737-800</td>\n",
       "      <td>6480||5940</td>\n",
       "      <td>541||406</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>f66d72ba3a526576608b8402b5720726</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT5H45M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650228840||1650241440</td>\n",
       "      <td>2022-04-17T15:54:00.000-05:00||2022-04-17T20:2...</td>\n",
       "      <td>ORD||BOS</td>\n",
       "      <td>ATL||ORD</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Embraer 175||Boeing 737-800</td>\n",
       "      <td>8100||8340</td>\n",
       "      <td>600||862</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>e7c4054e85cca9bc7134b3cc93deaf7c</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT5H59M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650240660||1650254340</td>\n",
       "      <td>2022-04-17T19:11:00.000-05:00||2022-04-17T23:5...</td>\n",
       "      <td>ORD||BOS</td>\n",
       "      <td>ATL||ORD</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Embraer 175||Boeing 737-800</td>\n",
       "      <td>7860||8640</td>\n",
       "      <td>600||862</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>5fa8c0f8b25eb24bf2ddc39a498bcc37</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>V0AJZNN1</td>\n",
       "      <td>PT7H18M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650228840||1650247020</td>\n",
       "      <td>2022-04-17T15:54:00.000-05:00||2022-04-17T21:5...</td>\n",
       "      <td>ORD||BOS</td>\n",
       "      <td>ATL||ORD</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>AA||AA</td>\n",
       "      <td>Embraer 175||Airbus A321</td>\n",
       "      <td>8100||7920</td>\n",
       "      <td>600||862</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>948d26b3e5658762cd62f842c87ae46e</td>\n",
       "      <td>2022-04-16</td>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>VAA0AKEN</td>\n",
       "      <td>PT8H10M</td>\n",
       "      <td>0.0</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>1650198000||1650219600</td>\n",
       "      <td>2022-04-17T07:20:00.000-05:00||2022-04-17T14:2...</td>\n",
       "      <td>ORD||BOS</td>\n",
       "      <td>ATL||ORD</td>\n",
       "      <td>United||United</td>\n",
       "      <td>UA||UA</td>\n",
       "      <td>Embraer 175 (Enhanced Winglets)||Boeing 737 MAX 9</td>\n",
       "      <td>7800||8640</td>\n",
       "      <td>600||862</td>\n",
       "      <td>coach||coach</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>15 rows × 27 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                               legId  searchDate  flightDate startingAirport  \\\n",
       "0   9ca0e81111c683bec1012473feefd28f  2022-04-16  2022-04-17             ATL   \n",
       "1   98685953630e772a098941b71906592b  2022-04-16  2022-04-17             ATL   \n",
       "2   98d90cbc32bfbb05c2fc32897c7c1087  2022-04-16  2022-04-17             ATL   \n",
       "3   969a269d38eae583f455486fa90877b4  2022-04-16  2022-04-17             ATL   \n",
       "4   980370cf27c89b40d2833a1d5afc9751  2022-04-16  2022-04-17             ATL   \n",
       "5   79eda9f841e226a1e2121d74211e595c  2022-04-16  2022-04-17             ATL   \n",
       "6   9335fae376c38bb61263281779f469ec  2022-04-16  2022-04-17             ATL   \n",
       "7   3904bf87f2d1daf334f1ae7e3b876028  2022-04-16  2022-04-17             ATL   \n",
       "8   d93988734c44a3c075d9efe373352507  2022-04-16  2022-04-17             ATL   \n",
       "9   562e7d5dd6ecbf1509c0c19711dbdca9  2022-04-16  2022-04-17             ATL   \n",
       "10  c38a6e4b807d15541e5866676febcbec  2022-04-16  2022-04-17             ATL   \n",
       "11  f66d72ba3a526576608b8402b5720726  2022-04-16  2022-04-17             ATL   \n",
       "12  e7c4054e85cca9bc7134b3cc93deaf7c  2022-04-16  2022-04-17             ATL   \n",
       "13  5fa8c0f8b25eb24bf2ddc39a498bcc37  2022-04-16  2022-04-17             ATL   \n",
       "14  948d26b3e5658762cd62f842c87ae46e  2022-04-16  2022-04-17             ATL   \n",
       "\n",
       "   destinationAirport fareBasisCode travelDuration  elapsedDays  \\\n",
       "0                 BOS      LA0NX0MC        PT2H29M          0.0   \n",
       "1                 BOS      LA0NX0MC        PT2H30M          0.0   \n",
       "2                 BOS      LA0NX0MC        PT2H30M          0.0   \n",
       "3                 BOS      LA0NX0MC        PT2H32M          0.0   \n",
       "4                 BOS      LA0NX0MC        PT2H34M          0.0   \n",
       "5                 BOS      VH0AUEL1        PT2H38M          0.0   \n",
       "6                 BOS      V0AJZNN1        PT4H12M          0.0   \n",
       "7                 BOS      V0AJZNN1        PT5H18M          0.0   \n",
       "8                 BOS      V0AJZNN1        PT5H32M          0.0   \n",
       "9                 BOS      V0AJZNN1        PT6H38M          0.0   \n",
       "10                BOS      VAA0AKEN        PT4H46M          0.0   \n",
       "11                BOS      V0AJZNN1        PT5H45M          0.0   \n",
       "12                BOS      V0AJZNN1        PT5H59M          0.0   \n",
       "13                BOS      V0AJZNN1        PT7H18M          0.0   \n",
       "14                BOS      VAA0AKEN        PT8H10M          0.0   \n",
       "\n",
       "    isBasicEconomy  isRefundable  ...  segmentsArrivalTimeEpochSeconds  \\\n",
       "0            False         False  ...                       1650223560   \n",
       "1            False         False  ...                       1650200400   \n",
       "2            False         False  ...                       1650218700   \n",
       "3            False         False  ...                       1650227460   \n",
       "4            False         False  ...                       1650213180   \n",
       "5            False         False  ...                       1650216180   \n",
       "6            False         False  ...           1650203400||1650213120   \n",
       "7            False         False  ...           1650203400||1650217080   \n",
       "8            False         False  ...           1650198060||1650213120   \n",
       "9            False         False  ...           1650198060||1650217080   \n",
       "10           False         False  ...           1650194280||1650204960   \n",
       "11           False         False  ...           1650228840||1650241440   \n",
       "12           False         False  ...           1650240660||1650254340   \n",
       "13           False         False  ...           1650228840||1650247020   \n",
       "14           False         False  ...           1650198000||1650219600   \n",
       "\n",
       "                               segmentsArrivalTimeRaw  \\\n",
       "0                       2022-04-17T15:26:00.000-04:00   \n",
       "1                       2022-04-17T09:00:00.000-04:00   \n",
       "2                       2022-04-17T14:05:00.000-04:00   \n",
       "3                       2022-04-17T16:31:00.000-04:00   \n",
       "4                       2022-04-17T12:33:00.000-04:00   \n",
       "5                       2022-04-17T13:23:00.000-04:00   \n",
       "6   2022-04-17T09:50:00.000-04:00||2022-04-17T12:3...   \n",
       "7   2022-04-17T09:50:00.000-04:00||2022-04-17T13:3...   \n",
       "8   2022-04-17T08:21:00.000-04:00||2022-04-17T12:3...   \n",
       "9   2022-04-17T08:21:00.000-04:00||2022-04-17T13:3...   \n",
       "10  2022-04-17T07:18:00.000-04:00||2022-04-17T10:1...   \n",
       "11  2022-04-17T15:54:00.000-05:00||2022-04-17T20:2...   \n",
       "12  2022-04-17T19:11:00.000-05:00||2022-04-17T23:5...   \n",
       "13  2022-04-17T15:54:00.000-05:00||2022-04-17T21:5...   \n",
       "14  2022-04-17T07:20:00.000-05:00||2022-04-17T14:2...   \n",
       "\n",
       "    segmentsArrivalAirportCode  segmentsDepartureAirportCode  \\\n",
       "0                          BOS                           ATL   \n",
       "1                          BOS                           ATL   \n",
       "2                          BOS                           ATL   \n",
       "3                          BOS                           ATL   \n",
       "4                          BOS                           ATL   \n",
       "5                          BOS                           ATL   \n",
       "6                     CLT||BOS                      ATL||CLT   \n",
       "7                     CLT||BOS                      ATL||CLT   \n",
       "8                     CLT||BOS                      ATL||CLT   \n",
       "9                     CLT||BOS                      ATL||CLT   \n",
       "10                    IAD||BOS                      ATL||IAD   \n",
       "11                    ORD||BOS                      ATL||ORD   \n",
       "12                    ORD||BOS                      ATL||ORD   \n",
       "13                    ORD||BOS                      ATL||ORD   \n",
       "14                    ORD||BOS                      ATL||ORD   \n",
       "\n",
       "                     segmentsAirlineName segmentsAirlineCode  \\\n",
       "0                                  Delta                  DL   \n",
       "1                                  Delta                  DL   \n",
       "2                                  Delta                  DL   \n",
       "3                                  Delta                  DL   \n",
       "4                                  Delta                  DL   \n",
       "5                        JetBlue Airways                  B6   \n",
       "6   American Airlines||American Airlines              AA||AA   \n",
       "7   American Airlines||American Airlines              AA||AA   \n",
       "8   American Airlines||American Airlines              AA||AA   \n",
       "9   American Airlines||American Airlines              AA||AA   \n",
       "10                        United||United              UA||UA   \n",
       "11  American Airlines||American Airlines              AA||AA   \n",
       "12  American Airlines||American Airlines              AA||AA   \n",
       "13  American Airlines||American Airlines              AA||AA   \n",
       "14                        United||United              UA||UA   \n",
       "\n",
       "                         segmentsEquipmentDescription  \\\n",
       "0                                         Airbus A321   \n",
       "1                                         Airbus A321   \n",
       "2                                      Boeing 757-200   \n",
       "3                                         Airbus A321   \n",
       "4                                         Airbus A321   \n",
       "5                                                 NaN   \n",
       "6                            Airbus A320||Airbus A320   \n",
       "7                         Airbus A320||Boeing 737-800   \n",
       "8                            Airbus A319||Airbus A320   \n",
       "9                         Airbus A319||Boeing 737-800   \n",
       "10                        Airbus A319||Boeing 737-800   \n",
       "11                        Embraer 175||Boeing 737-800   \n",
       "12                        Embraer 175||Boeing 737-800   \n",
       "13                           Embraer 175||Airbus A321   \n",
       "14  Embraer 175 (Enhanced Winglets)||Boeing 737 MAX 9   \n",
       "\n",
       "   segmentsDurationInSeconds segmentsDistance segmentsCabinCode  \n",
       "0                       8940              947             coach  \n",
       "1                       9000              947             coach  \n",
       "2                       9000              947             coach  \n",
       "3                       9120              947             coach  \n",
       "4                       9240              947             coach  \n",
       "5                       9480              947             coach  \n",
       "6                 5400||7500         228||728      coach||coach  \n",
       "7                 5400||8280         228||728      coach||coach  \n",
       "8                 4860||7500         228||728      coach||coach  \n",
       "9                 4860||8280         228||728      coach||coach  \n",
       "10                6480||5940         541||406      coach||coach  \n",
       "11                8100||8340         600||862      coach||coach  \n",
       "12                7860||8640         600||862      coach||coach  \n",
       "13                8100||7920         600||862      coach||coach  \n",
       "14                7800||8640         600||862      coach||coach  \n",
       "\n",
       "[15 rows x 27 columns]"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_csv(FLIGHT_PRICES_CSV)\n",
    "df.head(n=15)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "52a7c85e-afa8-4d61-81cf-9543d6f73fd2",
   "metadata": {},
   "outputs": [],
   "source": [
    "startingAirports =set(df.startingAirport.unique().tolist())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "144de68c-893b-4bcd-afd6-8c8067137400",
   "metadata": {},
   "outputs": [],
   "source": [
    "destinationAirports =set(df.destinationAirport.unique().tolist())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "9726dcb0-a4db-4bf6-b064-3517f8de45d4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "set()"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "missing = startingAirports - destinationAirports\n",
    "missing"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "a6dc5359-91aa-494a-8c89-f699300ef7f2",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting airportsdata\n",
      "  Downloading airportsdata-20250224-py3-none-any.whl.metadata (9.0 kB)\n",
      "Downloading airportsdata-20250224-py3-none-any.whl (913 kB)\n",
      "\u001b[2K   \u001b[38;2;114;156;31m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m913.7/913.7 kB\u001b[0m \u001b[31m7.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
      "Installing collected packages: airportsdata\n",
      "Successfully installed airportsdata-20250224\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "%pip install -U airportsdata"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "6da3f451-d0a4-4e15-b876-31820c4817ff",
   "metadata": {},
   "outputs": [],
   "source": [
    "import airportsdata\n",
    "airports = airportsdata.load('IATA')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "aab707ff-351d-44e4-ac84-4b9b509df497",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'icao': 'KCLT',\n",
       "  'iata': 'CLT',\n",
       "  'name': 'Charlotte/Douglas International Airport',\n",
       "  'city': 'Charlotte',\n",
       "  'subd': 'North Carolina',\n",
       "  'country': 'US',\n",
       "  'elevation': 747.9,\n",
       "  'lat': 35.21375,\n",
       "  'lon': -80.94906,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'CLT'},\n",
       " {'icao': 'KLAX',\n",
       "  'iata': 'LAX',\n",
       "  'name': 'Los Angeles International Airport',\n",
       "  'city': 'Los Angeles',\n",
       "  'subd': 'California',\n",
       "  'country': 'US',\n",
       "  'elevation': 127.8,\n",
       "  'lat': 33.9425,\n",
       "  'lon': -118.40805,\n",
       "  'tz': 'America/Los_Angeles',\n",
       "  'lid': 'LAX'},\n",
       " {'icao': 'KSFO',\n",
       "  'iata': 'SFO',\n",
       "  'name': 'San Francisco International Airport',\n",
       "  'city': 'San Francisco',\n",
       "  'subd': 'California',\n",
       "  'country': 'US',\n",
       "  'elevation': 13.1,\n",
       "  'lat': 37.61881,\n",
       "  'lon': -122.37542,\n",
       "  'tz': 'America/Los_Angeles',\n",
       "  'lid': 'SFO'},\n",
       " {'icao': 'KBOS',\n",
       "  'iata': 'BOS',\n",
       "  'name': 'General Edward Lawrence Logan International Airport',\n",
       "  'city': 'Boston',\n",
       "  'subd': 'Massachusetts',\n",
       "  'country': 'US',\n",
       "  'elevation': 19.1,\n",
       "  'lat': 42.36294,\n",
       "  'lon': -71.00639,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'BOS'},\n",
       " {'icao': 'KEWR',\n",
       "  'iata': 'EWR',\n",
       "  'name': 'Newark Liberty International Airport',\n",
       "  'city': 'Newark',\n",
       "  'subd': 'New Jersey',\n",
       "  'country': 'US',\n",
       "  'elevation': 17.4,\n",
       "  'lat': 40.69248,\n",
       "  'lon': -74.16869,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'EWR'},\n",
       " {'icao': 'KJFK',\n",
       "  'iata': 'JFK',\n",
       "  'name': 'John F Kennedy International Airport',\n",
       "  'city': 'New York',\n",
       "  'subd': 'New York',\n",
       "  'country': 'US',\n",
       "  'elevation': 13.0,\n",
       "  'lat': 40.63993,\n",
       "  'lon': -73.77869,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'JFK'},\n",
       " {'icao': 'KORD',\n",
       "  'iata': 'ORD',\n",
       "  'name': \"Chicago O'Hare International Airport\",\n",
       "  'city': 'Chicago',\n",
       "  'subd': 'Illinois',\n",
       "  'country': 'US',\n",
       "  'elevation': 680.0,\n",
       "  'lat': 41.97694,\n",
       "  'lon': -87.90815,\n",
       "  'tz': 'America/Chicago',\n",
       "  'lid': 'ORD'},\n",
       " {'icao': 'KMIA',\n",
       "  'iata': 'MIA',\n",
       "  'name': 'Miami International Airport',\n",
       "  'city': 'Miami',\n",
       "  'subd': 'Florida',\n",
       "  'country': 'US',\n",
       "  'elevation': 9.3,\n",
       "  'lat': 25.79536,\n",
       "  'lon': -80.29012,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'MIA'},\n",
       " {'icao': 'KDTW',\n",
       "  'iata': 'DTW',\n",
       "  'name': 'Detroit Metro Wayne County Airport',\n",
       "  'city': 'Detroit',\n",
       "  'subd': 'Michigan',\n",
       "  'country': 'US',\n",
       "  'elevation': 645.2,\n",
       "  'lat': 42.21244,\n",
       "  'lon': -83.35339,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'DTW'},\n",
       " {'icao': 'KPHL',\n",
       "  'iata': 'PHL',\n",
       "  'name': 'Philadelphia International Airport',\n",
       "  'city': 'Philadelphia',\n",
       "  'subd': 'Pennsylvania',\n",
       "  'country': 'US',\n",
       "  'elevation': 35.9,\n",
       "  'lat': 39.87208,\n",
       "  'lon': -75.24066,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'PHL'},\n",
       " {'icao': 'KATL',\n",
       "  'iata': 'ATL',\n",
       "  'name': 'Hartsfield - Jackson Atlanta International Airport',\n",
       "  'city': 'Atlanta',\n",
       "  'subd': 'Georgia',\n",
       "  'country': 'US',\n",
       "  'elevation': 1026.2,\n",
       "  'lat': 33.6367,\n",
       "  'lon': -84.42786,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'ATL'},\n",
       " {'icao': 'KDEN',\n",
       "  'iata': 'DEN',\n",
       "  'name': 'Denver International Airport',\n",
       "  'city': 'Denver',\n",
       "  'subd': 'Colorado',\n",
       "  'country': 'US',\n",
       "  'elevation': 5433.8,\n",
       "  'lat': 39.86167,\n",
       "  'lon': -104.67317,\n",
       "  'tz': 'America/Denver',\n",
       "  'lid': 'DEN'},\n",
       " {'icao': 'KOAK',\n",
       "  'iata': 'OAK',\n",
       "  'name': 'Metro Oakland International Airport',\n",
       "  'city': 'Oakland',\n",
       "  'subd': 'California',\n",
       "  'country': 'US',\n",
       "  'elevation': 9.0,\n",
       "  'lat': 37.72125,\n",
       "  'lon': -122.22114,\n",
       "  'tz': 'America/Los_Angeles',\n",
       "  'lid': 'OAK'},\n",
       " {'icao': 'KIAD',\n",
       "  'iata': 'IAD',\n",
       "  'name': 'Washington Dulles International Airport',\n",
       "  'city': 'Washington',\n",
       "  'subd': 'Dist. Of Columbia',\n",
       "  'country': 'US',\n",
       "  'elevation': 312.3,\n",
       "  'lat': 38.9,\n",
       "  'lon': -77.5,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'IAD'},\n",
       " {'icao': 'KLGA',\n",
       "  'iata': 'LGA',\n",
       "  'name': 'Laguardia Airport',\n",
       "  'city': 'New York',\n",
       "  'subd': 'New York',\n",
       "  'country': 'US',\n",
       "  'elevation': 20.6,\n",
       "  'lat': 40.77725,\n",
       "  'lon': -73.87261,\n",
       "  'tz': 'America/New_York',\n",
       "  'lid': 'LGA'},\n",
       " {'icao': 'KDFW',\n",
       "  'iata': 'DFW',\n",
       "  'name': 'Dallas-Fort Worth International Airport',\n",
       "  'city': 'Dallas-Fort Worth',\n",
       "  'subd': 'Texas',\n",
       "  'country': 'US',\n",
       "  'elevation': 606.4,\n",
       "  'lat': 32.89723,\n",
       "  'lon': -97.03769,\n",
       "  'tz': 'America/Chicago',\n",
       "  'lid': 'DFW'}]"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "available_airports = [airports[x] for x in startingAirports]\n",
    "available_airports"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "6731f33a-773c-4f08-9368-aba3f3feb308",
   "metadata": {},
   "outputs": [],
   "source": [
    "airports_df=pd.DataFrame(available_airports)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "c6c33224-a23c-44a3-be73-c1060168bb17",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "icao          object\n",
       "iata          object\n",
       "name          object\n",
       "city          object\n",
       "subd          object\n",
       "country       object\n",
       "elevation    float64\n",
       "lat          float64\n",
       "lon          float64\n",
       "tz            object\n",
       "lid           object\n",
       "dtype: object"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "airports_df.dtypes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "cbcb11d6-57dd-4426-b364-045dca3596c4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "16"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "table_name = \"airports\"\n",
    "airports_df.to_sql(table_name, engine, if_exists='replace', index= True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "b85cef09-0909-46d3-8ac7-27768ec64556",
   "metadata": {},
   "outputs": [],
   "source": [
    "from sqlalchemy import create_engine, Column, BigInteger,String, Float\n",
    "from sqlalchemy.orm import sessionmaker, DeclarativeBase\n",
    "\n",
    "class Base(DeclarativeBase):\n",
    "    pass\n",
    "\n",
    "class Airport(Base):\n",
    "    __tablename__ = \"airports\"\n",
    "    __table_args__ = {\"extend_existing\": True}\n",
    "    id = Column(\"index\", BigInteger, primary_key=True)\n",
    "    name = Column(String)\n",
    "    icao = Column(String)\n",
    "    iata = Column(String)\n",
    "    city = Column(String)\n",
    "    subd = Column(String)\n",
    "    country = Column(String)\n",
    "    elevation = Column(Float)\n",
    "    lat = Column(Float)\n",
    "    lon = Column(Float)\n",
    "    tz = Column(String)\n",
    "    lid = Column(String)\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "51b73a1f-b269-41e3-ae4a-7c8c9de3ab68",
   "metadata": {},
   "outputs": [],
   "source": [
    "from pydantic import BaseModel, Field\n",
    "\n",
    "class AirportSchema(BaseModel): # pydantic\n",
    "    id: int\n",
    "    label: str = Field(alias=\"name\")\n",
    "    value: str = Field(alias=\"iata\")\n",
    "\n",
    "    class Config:\n",
    "        from_attributes = True"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "8cd7f237-8343-4ea6-8095-3eae95bd4830",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{\"id\":0,\"label\":\"Charlotte/Douglas International Airport\",\"value\":\"CLT\"}\n",
      "{\"id\":1,\"label\":\"Los Angeles International Airport\",\"value\":\"LAX\"}\n",
      "{\"id\":2,\"label\":\"San Francisco International Airport\",\"value\":\"SFO\"}\n",
      "{\"id\":3,\"label\":\"General Edward Lawrence Logan International Airport\",\"value\":\"BOS\"}\n",
      "{\"id\":4,\"label\":\"Newark Liberty International Airport\",\"value\":\"EWR\"}\n",
      "{\"id\":5,\"label\":\"John F Kennedy International Airport\",\"value\":\"JFK\"}\n",
      "{\"id\":6,\"label\":\"Chicago O'Hare International Airport\",\"value\":\"ORD\"}\n",
      "{\"id\":7,\"label\":\"Miami International Airport\",\"value\":\"MIA\"}\n",
      "{\"id\":8,\"label\":\"Detroit Metro Wayne County Airport\",\"value\":\"DTW\"}\n",
      "{\"id\":9,\"label\":\"Philadelphia International Airport\",\"value\":\"PHL\"}\n"
     ]
    }
   ],
   "source": [
    "SessionLocal = sessionmaker(bind=engine)\n",
    "session = SessionLocal()\n",
    "\n",
    "queryset = session.query(Airport).limit(10).all()\n",
    "for row_value in queryset:\n",
    "    data = AirportSchema.model_validate(row_value)\n",
    "    print(data.model_dump_json())\n",
    "\n",
    "session.close()   "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "id": "d030fbe6-4453-4f71-9ff3-b6682ffd233c",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>flightDate</th>\n",
       "      <th>startingAirport</th>\n",
       "      <th>destinationAirport</th>\n",
       "      <th>isBasicEconomy</th>\n",
       "      <th>isRefundable</th>\n",
       "      <th>isNonStop</th>\n",
       "      <th>segmentsAirlineName</th>\n",
       "      <th>totalFare</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>273</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Spirit Airlines||Spirit Airlines</td>\n",
       "      <td>301</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>352</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>American Airlines</td>\n",
       "      <td>355</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Delta</td>\n",
       "      <td>307</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>JetBlue Airways</td>\n",
       "      <td>302</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>BOS</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>307</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>CLT</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>492</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>CLT</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>JetBlue Airways||JetBlue Airways</td>\n",
       "      <td>543</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>CLT</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>467</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>CLT</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>American Airlines</td>\n",
       "      <td>425</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>CLT</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Delta</td>\n",
       "      <td>399</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>305</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Frontier Airlines||Frontier Airlines</td>\n",
       "      <td>554</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Spirit Airlines||Spirit Airlines</td>\n",
       "      <td>273</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>320</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Delta</td>\n",
       "      <td>297</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Frontier Airlines</td>\n",
       "      <td>134</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DEN</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>United</td>\n",
       "      <td>297</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>211</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Spirit Airlines||Spirit Airlines</td>\n",
       "      <td>344</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>227</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>American Airlines</td>\n",
       "      <td>212</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Delta</td>\n",
       "      <td>224</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Frontier Airlines</td>\n",
       "      <td>404</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DFW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Spirit Airlines</td>\n",
       "      <td>169</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Delta||Cape Air||Cape Air||Delta</td>\n",
       "      <td>788</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Delta||Delta</td>\n",
       "      <td>568</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Delta||United</td>\n",
       "      <td>432</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>JetBlue Airways||JetBlue Airways</td>\n",
       "      <td>314</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Spirit Airlines||Spirit Airlines</td>\n",
       "      <td>312</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>284</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Delta</td>\n",
       "      <td>499</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>DTW</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Spirit Airlines</td>\n",
       "      <td>166</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>EWR</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>American Airlines||American Airlines</td>\n",
       "      <td>237</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>EWR</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>Spirit Airlines||Spirit Airlines</td>\n",
       "      <td>372</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>EWR</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>United||United</td>\n",
       "      <td>263</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>EWR</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>American Airlines</td>\n",
       "      <td>229</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>2022-04-17</td>\n",
       "      <td>ATL</td>\n",
       "      <td>EWR</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>Delta</td>\n",
       "      <td>220</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   flightDate startingAirport destinationAirport  isBasicEconomy  \\\n",
       "0  2022-04-17             ATL                BOS           False   \n",
       "1  2022-04-17             ATL                BOS           False   \n",
       "2  2022-04-17             ATL                BOS           False   \n",
       "3  2022-04-17             ATL                BOS           False   \n",
       "4  2022-04-17             ATL                BOS           False   \n",
       "5  2022-04-17             ATL                BOS           False   \n",
       "6  2022-04-17             ATL                BOS            True   \n",
       "7  2022-04-17             ATL                CLT           False   \n",
       "8  2022-04-17             ATL                CLT           False   \n",
       "9  2022-04-17             ATL                CLT           False   \n",
       "10 2022-04-17             ATL                CLT           False   \n",
       "11 2022-04-17             ATL                CLT           False   \n",
       "12 2022-04-17             ATL                DEN           False   \n",
       "13 2022-04-17             ATL                DEN           False   \n",
       "14 2022-04-17             ATL                DEN           False   \n",
       "15 2022-04-17             ATL                DEN           False   \n",
       "16 2022-04-17             ATL                DEN           False   \n",
       "17 2022-04-17             ATL                DEN           False   \n",
       "18 2022-04-17             ATL                DEN           False   \n",
       "19 2022-04-17             ATL                DFW           False   \n",
       "20 2022-04-17             ATL                DFW           False   \n",
       "21 2022-04-17             ATL                DFW           False   \n",
       "22 2022-04-17             ATL                DFW           False   \n",
       "23 2022-04-17             ATL                DFW           False   \n",
       "24 2022-04-17             ATL                DFW           False   \n",
       "25 2022-04-17             ATL                DFW           False   \n",
       "26 2022-04-17             ATL                DTW           False   \n",
       "27 2022-04-17             ATL                DTW           False   \n",
       "28 2022-04-17             ATL                DTW           False   \n",
       "29 2022-04-17             ATL                DTW           False   \n",
       "30 2022-04-17             ATL                DTW           False   \n",
       "31 2022-04-17             ATL                DTW           False   \n",
       "32 2022-04-17             ATL                DTW           False   \n",
       "33 2022-04-17             ATL                DTW           False   \n",
       "34 2022-04-17             ATL                DTW           False   \n",
       "35 2022-04-17             ATL                EWR           False   \n",
       "36 2022-04-17             ATL                EWR           False   \n",
       "37 2022-04-17             ATL                EWR           False   \n",
       "38 2022-04-17             ATL                EWR           False   \n",
       "39 2022-04-17             ATL                EWR           False   \n",
       "\n",
       "    isRefundable  isNonStop                   segmentsAirlineName  totalFare  \n",
       "0          False      False  American Airlines||American Airlines        273  \n",
       "1          False      False      Spirit Airlines||Spirit Airlines        301  \n",
       "2          False      False                        United||United        352  \n",
       "3          False       True                     American Airlines        355  \n",
       "4          False       True                                 Delta        307  \n",
       "5          False       True                       JetBlue Airways        302  \n",
       "6          False      False                        United||United        307  \n",
       "7          False      False  American Airlines||American Airlines        492  \n",
       "8          False      False      JetBlue Airways||JetBlue Airways        543  \n",
       "9          False      False                        United||United        467  \n",
       "10         False       True                     American Airlines        425  \n",
       "11         False       True                                 Delta        399  \n",
       "12         False      False  American Airlines||American Airlines        305  \n",
       "13         False      False  Frontier Airlines||Frontier Airlines        554  \n",
       "14         False      False      Spirit Airlines||Spirit Airlines        273  \n",
       "15         False      False                        United||United        320  \n",
       "16         False       True                                 Delta        297  \n",
       "17         False       True                     Frontier Airlines        134  \n",
       "18         False       True                                United        297  \n",
       "19         False      False  American Airlines||American Airlines        211  \n",
       "20         False      False      Spirit Airlines||Spirit Airlines        344  \n",
       "21         False      False                        United||United        227  \n",
       "22         False       True                     American Airlines        212  \n",
       "23         False       True                                 Delta        224  \n",
       "24         False       True                     Frontier Airlines        404  \n",
       "25         False       True                       Spirit Airlines        169  \n",
       "26         False      False  American Airlines||American Airlines        250  \n",
       "27         False      False      Delta||Cape Air||Cape Air||Delta        788  \n",
       "28         False      False                          Delta||Delta        568  \n",
       "29         False      False                         Delta||United        432  \n",
       "30         False      False      JetBlue Airways||JetBlue Airways        314  \n",
       "31         False      False      Spirit Airlines||Spirit Airlines        312  \n",
       "32         False      False                        United||United        284  \n",
       "33         False       True                                 Delta        499  \n",
       "34         False       True                       Spirit Airlines        166  \n",
       "35         False      False  American Airlines||American Airlines        237  \n",
       "36         False      False      Spirit Airlines||Spirit Airlines        372  \n",
       "37         False      False                        United||United        263  \n",
       "38         False       True                     American Airlines        229  \n",
       "39         False       True                                 Delta        220  "
      ]
     },
     "execution_count": 48,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "group_by_columns = ['flightDate' , 'startingAirport' , 'destinationAirport', 'isBasicEconomy', 'isRefundable', 'isNonStop', 'segmentsAirlineName']\n",
    "target_column = 'totalFare'\n",
    "desired_columns = group_by_columns + [target_column]\n",
    "sub_df = df.copy()[desired_columns\n",
    "sub_df = sub_df.groupby(group_by_columns)[target_column].mean().reset_index()\n",
    "sub_df['startingAirport'] = sub_df['startingAirport'].apply(lambda x: f\"{x}\".strip())\n",
    "sub_df['destinationAirport'] = sub_df['destinationAirport'].apply(lambda x: f\"{x}\".strip())\n",
    "sub_df['totalFare'] = sub_df['totalFare'].round(0).apply(lambda x: int(x))\n",
    "sub_df.dropna(inplace=True)\n",
    "sub_df.head(n=40)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
